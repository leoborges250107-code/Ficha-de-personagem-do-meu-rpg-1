<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ficha de RPG</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 40px; }
    .container { background: #fff; margin: auto; max-width: 700px; padding: 24px 32px 32px 32px; border-radius: 16px; box-shadow: 0 0 10px #bbb; }
    h1 { text-align: center; }
    .campo { margin-bottom: 12px; }
    label { display: block; font-weight: bold; margin-bottom: 4px; }
    input[type="text"], textarea { width: 100%; padding: 6px; font-size: 1em; margin-bottom: 6px; border-radius: 5px; border: 1px solid #bbb; }
    .atributos { display: flex; flex-wrap: wrap; margin-bottom: 18px; gap: 12px; }
    .atributo-block { flex: 1 0 32%; background: #f0f0f0; border-radius: 8px; padding: 10px; margin-bottom: 6px; min-width: 160px;}
    .atributo-block label { font-size: 1em; margin-bottom: 6px; }
    .quadrado-grande { width: 48px; height: 48px; font-size: 1.3em; text-align: center; border: 2px solid #444; border-radius: 6px; margin-bottom: 5px; }
    .quadrado-pequeno { width: 32px; height: 24px; font-size: 1em; text-align: center; border: 2px solid #888; border-radius: 6px; }
    .info { background: #e8e8e8; padding: 8px 12px; border-radius: 6px; margin-bottom: 18px; font-size: 1.1em; }
    .pericias { margin-bottom: 18px; }
    .pericia-row { display: flex; align-items: center; margin-bottom: 4px; }
    .pericia-nome, .pericia-bonus, .pericia-atributo { width: 120px; display: inline-block; }
    .pericia-bonus input { width: 32px; text-align: center; border: 1px solid #bbb; border-radius: 4px; }
    textarea { min-height: 60px; }
    .pontos-restantes { color: #005a0f; font-weight: bold; }
    .botao-baixar { margin-top: 10px; }
  </style>
</head>
<body>
<div class="container">
  <h1>Ficha de RPG</h1>
  
  <div class="campo">
    <label for="nome">Nome:</label>
    <input type="text" id="nome">
  </div>
  <div class="campo">
    <label for="raca">Raça:</label>
    <input type="text" id="raca">
  </div>
  
  <div class="info">
    Pontos para distribuir: <span id="pontosRestantes" class="pontos-restantes">28</span>
  </div>
  
  <div class="atributos">
    <!-- Atributos -->
    <div class="atributo-block">
      <label>Força (FOR)</label>
      <input type="number" min="8" max="18" step="1" value="8" class="quadrado-grande" id="for">
      <input type="text" disabled class="quadrado-pequeno" id="forBonus">
    </div>
    <div class="atributo-block">
      <label>Destreza (DEX)</label>
      <input type="number" min="8" max="18" step="1" value="8" class="quadrado-grande" id="dex">
      <input type="text" disabled class="quadrado-pequeno" id="dexBonus">
    </div>
    <div class="atributo-block">
      <label>Constituição (CON)</label>
      <input type="number" min="8" max="18" step="1" value="8" class="quadrado-grande" id="con">
      <input type="text" disabled class="quadrado-pequeno" id="conBonus">
    </div>
    <div class="atributo-block">
      <label>Inteligência (INT)</label>
      <input type="number" min="8" max="18" step="1" value="8" class="quadrado-grande" id="int">
      <input type="text" disabled class="quadrado-pequeno" id="intBonus">
    </div>
    <div class="atributo-block">
      <label>Sabedoria (SAB)</label>
      <input type="number" min="8" max="18" step="1" value="8" class="quadrado-grande" id="sab">
      <input type="text" disabled class="quadrado-pequeno" id="sabBonus">
    </div>
    <div class="atributo-block">
      <label>Carisma (CAR)</label>
      <input type="number" min="8" max="18" step="1" value="8" class="quadrado-grande" id="car">
      <input type="text" disabled class="quadrado-pequeno" id="carBonus">
    </div>
  </div>
  
  <div class="info">
    <b>Classe de Armadura (CA):</b> <span id="ca">0</span>
    &nbsp; | &nbsp; <b>Vida:</b> <span id="vida">0</span>
  </div>
  
  <div class="pericias">
    <h3>Perícias</h3>
    <div id="pericias-list"></div>
  </div>
  
  <div class="campo">
    <label for="lore">Lore/Características Gerais:</label>
    <textarea id="lore"></textarea>
  </div>
  
  <button class="botao-baixar" onclick="baixarFicha()">Baixar Ficha (TXT)</button>
</div>

<script>
  // Configuração dos atributos e perícias
  const atributos = [
    { id: 'for', nome: 'Força', abrev: 'FOR' },
    { id: 'dex', nome: 'Destreza', abrev: 'DEX' },
    { id: 'con', nome: 'Constituição', abrev: 'CON' },
    { id: 'int', nome: 'Inteligência', abrev: 'INT' },
    { id: 'sab', nome: 'Sabedoria', abrev: 'SAB' },
    { id: 'car', nome: 'Carisma', abrev: 'CAR' }
  ];

  const pericias = [
    { nome: 'Acrobacia', atributo: 'dex' },
    { nome: 'Arcanismo', atributo: 'int' },
    { nome: 'Atletismo', atributo: 'for' },
    { nome: 'Atuação', atributo: 'car' },
    { nome: 'Blefe', atributo: 'car' },
    { nome: 'Furtividade', atributo: 'dex' },
    { nome: 'História', atributo: 'int' },
    { nome: 'Intimidação', atributo: 'car' },
    { nome: 'Intuição', atributo: 'sab' },
    { nome: 'Investigação', atributo: 'int' },
    { nome: 'Lidar com os Animais', atributo: 'sab' },
    { nome: 'Medicina', atributo: 'sab' },
    { nome: 'Natureza', atributo: 'int' },
    { nome: 'Percepção', atributo: 'sab' },
    { nome: 'Persuasão', atributo: 'car' },
    { nome: 'Prestidigitação', atributo: 'dex' },
    { nome: 'Religião', atributo: 'int' },
    { nome: 'Sobrevivência', atributo: 'sab' }
  ];

  // Gera as linhas das perícias
  const periciasDiv = document.getElementById('pericias-list');
  pericias.forEach(p => {
    const row = document.createElement('div');
    row.classList.add('pericia-row');
    row.innerHTML = `
      <span class="pericia-nome">${p.nome}</span>
      <span class="pericia-bonus"><input type="text" disabled id="bonus-${p.nome.replace(/ /g,'')}" value="0"></span>
      <span class="pericia-atributo">${atributos.find(a=>a.id===p.atributo).nome}</span>
    `;
    periciasDiv.appendChild(row);
  });

  // Função para calcular bônus a cada 2 pontos acima de 8
  function calculaBonus(valor) {
    return Math.floor((valor - 8) / 2) || -1;
  }

  // Atualiza tudo quando algum valor de atributo é mudado
  function atualizaFicha() {
    let pontosUsados = 0;
    let valores = {};
    atributos.forEach(attr => {
      const val = parseInt(document.getElementById(attr.id).value, 10) || 8;
      valores[attr.id] = val;
      pontosUsados += (val - 8);
      // Atualiza bônus visualmente
      document.getElementById(attr.id+'Bonus').value = calculaBonus(val);
    });
    // Limita os pontos
    let pontosRestantes = 28 - pontosUsados;
    document.getElementById('pontosRestantes').textContent = pontosRestantes;
    // Previne passar do limite
    if (pontosRestantes < 0) {
      atributos.forEach(attr => {
        let el = document.getElementById(attr.id);
        if (parseInt(el.value) > 8) {
          el.value = parseInt(el.value)-1;
        }
      });
      atualizaFicha();
      return;
    }
    // Atualiza CA (bônus de con + sab + dex)
    const ca = calculaBonus(valores.con) + calculaBonus(valores.sab) + calculaBonus(valores.dex);
    document.getElementById('ca').textContent = ca;
    // Vida = dobro do valor bruto de constituição
    document.getElementById('vida').textContent = valores.con * 2;
    // Atualiza bônus das perícias
    pericias.forEach(p => {
      const bonus = calculaBonus(valores[p.atributo]);
      document.getElementById('bonus-'+p.nome.replace(/ /g,'')).value = bonus;
    });
  }

  // Adiciona evento em cada atributo
  atributos.forEach(attr => {
    document.getElementById(attr.id).addEventListener('input', atualizaFicha);
  });
  window.onload = atualizaFicha;

  // Função para baixar ficha em TXT
  function baixarFicha() {
    let txt = '';
    txt += `Nome: ${document.getElementById('nome').value}\n`;
    txt += `Raça: ${document.getElementById('raca').value}\n\n`;
    txt += `Atributos:\n`;
    atributos.forEach(attr => {
      let val = document.getElementById(attr.id).value;
      let bonus = document.getElementById(attr.id+'Bonus').value;
      txt += `  ${attr.nome} (${attr.abrev}): ${val} [Bônus: ${bonus}]\n`;
    });
    txt += `\nCA: ${document.getElementById('ca').textContent}\n`;
    txt += `Vida: ${document.getElementById('vida').textContent}\n\n`;
    txt += `Perícias:\n`;
    pericias.forEach(p => {
      let bonus = document.getElementById('bonus-'+p.nome.replace(/ /g,'')).value;
      let atributo = atributos.find(a=>a.id===p.atributo).nome;
      txt += `  ${p.nome}: ${bonus} (${atributo})\n`;
    });
    txt += `\nLore/Características Gerais:\n${document.getElementById('lore').value}\n`;
    // Download
    const blob = new Blob([txt], {type: 'text/plain'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'ficha-rpg.txt';
    link.click();
  }
</script>
</body>
</html>