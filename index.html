<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Ficha de RPG com Raça e Classe</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #E6E0F8;
    padding: 20px;
    color: #3C2F5E;
  }
  h1, h2 {
    text-align: center;
    color: #4B3F72;
  }
  .container {
    max-width: 900px;
    margin: auto;
    background: #F3EFFF;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 0 12px rgba(75, 63, 114, 0.4);
  }
  label {
    font-weight: bold;
    margin-top: 10px;
    display: block;
    color: #4B3F72;
  }
  select, input[type="text"], input[type="password"], input[type="number"], textarea {
    padding: 6px;
    margin-top: 4px;
    width: 100%;
    box-sizing: border-box;
    font-size: 1em;
    border-radius: 5px;
    border: 1px solid #B9A9D6;
    background: #F9F6FF;
    color: #3C2F5E;
  }
  textarea {
    min-height: 80px;
  }
  .atributos {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 18px;
  }
  .atributo-block {
    background: #DDD9F7;
    border-radius: 8px;
    padding: 10px;
    flex: 1 0 30%;
    min-width: 140px;
    box-sizing: border-box;
  }
  .atributo-block label {
    font-size: 1em;
    margin-bottom: 6px;
    display: block;
  }
  .quadrado-grande {
    width: 50px;
    height: 48px;
    font-size: 1.3em;
    text-align: center;
    border: 2px solid #6B5EA5;
    border-radius: 6px;
    margin-bottom: 5px;
    background: white;
    color: #3C2F5E;
  }
  .bonus-racial {
    font-size: 0.85em;
    color: #4B3F72;
    margin-left: 6px;
    font-weight: bold;
  }
  .info {
    background: #D9D4F3;
    padding: 8px 12px;
    border-radius: 6px;
    margin-bottom: 12px;
    font-size: 1.1em;
    color: #3C2F5E;
  }
  .pericias {
    margin-bottom: 18px;
  }
  .pericia-row {
    display: flex;
    align-items: center;
    margin-bottom: 4px;
  }
  .pericia-nome, .pericia-bonus, .pericia-atributo {
    width: 140px;
    display: inline-block;
  }
  .pericia-bonus input {
    width: 36px;
    text-align: center;
    border: 1px solid #BBB;
    border-radius: 4px;
    background: #F9F6FF;
    color: #3C2F5E;
  }
  .mensagem-erro {
    color: #C1272D;
    font-weight: bold;
    margin-top: 8px;
  }
  .botao-baixar, button {
    background: #6B5EA5;
    color: white;
    font-weight: bold;
    border: none;
    padding: 10px 18px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 12px;
  }
  .botao-baixar:hover, button:hover {
    background: #5A4B8A;
  }
  .inline-flex {
    display: flex;
    gap: 12px;
    align-items: center;
  }
  .flex-col {
    flex-direction: column;
  }
  .campo-pequeno {
    width: 80px;
  }
  .campo-medio {
    width: 150px;
  }
  .traços {
    background: #C9C2F1;
    border-radius: 6px;
    padding: 12px;
    font-size: 0.95em;
    line-height: 1.3em;
    color: #3C2F5E;
    white-space: pre-wrap;
    margin-bottom: 20px;
  }
  .negrito {
    font-weight: bold;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Ficha de RPG</h1>

  <div class="inline-flex">
    <div style="flex:1;">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" />
    </div>
    <div style="flex:1;">
      <label for="nivel">Nível:</label>
      <input type="number" id="nivel" min="1" value="1" class="campo-pequeno" />
    </div>
  </div>

  <div class="inline-flex" style="margin-top:10px;">
    <div style="flex:1;">
      <label for="raca">Raça:</label>
      <select id="raca">
        <option value="anão">Anão</option>
        <option value="elfo">Elfo</option>
        <option value="halfling">Halfling</option>
        <option value="humano">Humano</option>
        <option value="draconato">Draconato</option>
        <option value="gnomo">Gnomo</option>
        <option value="meio-elfo">Meio-elfo</option>
        <option value="meio-orc">Meio-orc</option>
        <option value="tiefling">Tiefling</option>
        <option value="outro">Outro...</option>
      </select>
      <input type="text" id="racaOutro" placeholder="Digite a raça" maxlength="20" style="display:none; margin-top:6px;" />
    </div>

    <div style="flex:1; margin-left: 12px;">
      <label for="classe">Classe:</label>
      <select id="classe">
        <option value="guerreiro">Guerreiro</option>
        <option value="mago">Mago</option>
        <option value="ladino">Ladino</option>
        <option value="clerigo">Clérigo</option>
        <option value="outro">Outro...</option>
      </select>
      <input type="text" id="classeOutro" placeholder="Digite a classe" maxlength="20" style="display:none; margin-top:6px;" />
    </div>
  </div>

  <div id="mensagemPontos" class="mensagem-erro" style="display:none;">Você não possui mais pontos para distribuir!</div>

  <div class="info">
    Pontos para distribuir: <span id="pontosRestantes" class="pontos-restantes">28</span>
    &nbsp; | &nbsp;
    Classe de Armadura (CA): <span id="ca">0</span>
    &nbsp; | &nbsp;
    Vida: <span id="vida">0</span>
    &nbsp; | &nbsp;
    Iniciativa: <span id="iniciativa">0</span>
  </div>

  <div class="atributos">
    <div class="atributo-block">
      <label for="for">Força (FOR)</label>
      <input type="number" min="8" max="20" step="1" value="8" id="for" class="quadrado-grande" />
      <span id="forBonusRacial" class="bonus-racial"></span>
      <input type="text" disabled id="forBonus" class="quadrado-pequeno" />
    </div>
    <div class="atributo-block">
      <label for="dex">Destreza (DEX)</label>
      <input type="number" min="8" max="20" step="1" value="8" id="dex" class="quadrado-grande" />
      <span id="dexBonusRacial" class="bonus-racial"></span>
      <input type="text" disabled id="dexBonus" class="quadrado-pequeno" />
    </div>
    <div class="atributo-block">
      <label for="con">Constituição (CON)</label>
      <input type="number" min="8" max="20" step="1" value="8" id="con" class="quadrado-grande" />
      <span id="conBonusRacial" class="bonus-racial"></span>
      <input type="text" disabled id="conBonus" class="quadrado-pequeno" />
    </div>
    <div class="atributo-block">
      <label for="int">Inteligência (INT)</label>
      <input type="number" min="8" max="20" step="1" value="8" id="int" class="quadrado-grande" />
      <span id="intBonusRacial" class="bonus-racial"></span>
      <input type="text" disabled id="intBonus" class="quadrado-pequeno" />
    </div>
    <div class="atributo-block">
      <label for="sab">Sabedoria (SAB)</label>
      <input type="number" min="8" max="20" step="1" value="8" id="sab" class="quadrado-grande" />
      <span id="sabBonusRacial" class="bonus-racial"></span>
      <input type="text" disabled id="sabBonus" class="quadrado-pequeno" />
    </div>
    <div class="atributo-block">
      <label for="car">Carisma (CAR)</label>
      <input type="number" min="8" max="20" step="1" value="8" id="car" class="quadrado-grande" />
      <span id="carBonusRacial" class="bonus-racial"></span>
      <input type="text" disabled id="carBonus" class="quadrado-pequeno" />
    </div>
  </div>

  <div class="pericias">
    <h2>Perícias</h2>
    <div id="pericias-list"></div>
  </div>

  <label for="lore">Lore / Características Gerais:</label>
  <textarea id="lore"></textarea>

  <label for="magias">Magias (separe por vírgulas):</label>
  <input type="text" id="magias" />

  <label>Traços da Raça:</label>
  <div id="tracos" class="traços"></div>

  <div class="inline-flex" style="gap:12px;">
    <button onclick="baixarFicha()">Baixar Ficha (TXT)</button>
    <button onclick="salvarFicha()">Salvar Ficha</button>
    <button onclick="carregarFicha()">Carregar Ficha</button>
    <button onclick="limparFicha()">Limpar Ficha</button>
  </div>

  <div id="msgSalvo" style="color:#2E7D32; font-weight:bold; margin-top:10px; display:none;">Ficha salva com sucesso!</div>
</div>

<script>
  const atributos = [
    { id: 'for', nome: 'Força', abrev: 'FOR' },
    { id: 'dex', nome: 'Destreza', abrev: 'DEX' },
    { id: 'con', nome: 'Constituição', abrev: 'CON' },
    { id: 'int', nome: 'Inteligência', abrev: 'INT' },
    { id: 'sab', nome: 'Sabedoria', abrev: 'SAB' },
    { id: 'car', nome: 'Carisma', abrev: 'CAR' }
  ];

  const pericias = [
    { nome: 'Acrobacia', atributo: 'dex' },
    { nome: 'Arcanismo', atributo: 'int' },
    { nome: 'Atletismo', atributo: 'for' },
    { nome: 'Atuação', atributo: 'car' },
    { nome: 'Blefe', atributo: 'car' },
    { nome: 'Furtividade', atributo: 'dex' },
    { nome: 'História', atributo: 'int' },
    { nome: 'Intimidação', atributo: 'car' },
    { nome: 'Intuição', atributo: 'sab' },
    { nome: 'Investigação', atributo: 'int' },
    { nome: 'Lidar com os Animais', atributo: 'sab' },
    { nome: 'Medicina', atributo: 'sab' },
    { nome: 'Natureza', atributo: 'int' },
    { nome: 'Percepção', atributo: 'sab' },
    { nome: 'Persuasão', atributo: 'car' },
    { nome: 'Prestidigitação', atributo: 'dex' },
    { nome: 'Religião', atributo: 'int' },
    { nome: 'Sobrevivência', atributo: 'sab' }
  ];

  // Bônus e traços raciais conforme passado
  const racas = {
    "anão": {
      bonus: { con: 2 },
      tracos: [
        "*Você tem vantagem em testes de resistência contra veneno* e resistência contra dano de veneno.",
        "*Você ganha 2 de vida máxima por nível.*"
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "elfo": {
      bonus: { sab: 2 },
      tracos: [
        "*Sentidos Aguçados:* Você é proficiente na perícia Percepção.",
        "*Ancestralidade Feérica:* Você tem vantagem em testes de resistência contra encantamentos, e magia não pode lhe fazer dormir."
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "halfling": {
      bonus: { dex: 2 },
      tracos: [
        "*Sortudo:* Ao tirar 1 no d20 em uma jogada de ataque, teste de habilidade ou teste de resistência, você pode rolar o dado novamente e deve usar a nova jogada.",
        "*Corajoso:* Você tem vantagem em testes de resistência contra medo."
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "humano": {
      bonus: {},
      tracos: [
        "Não possui traços raciais especiais."
      ],
      pontosExtrasNivel1: 4,
      pontosExtrasPorNivel: 1
    },
    "draconato": {
      bonus: { for: 2 },
      tracos: [
        "*Seu CA aumenta também com força (bônus de Força soma no CA).",
        "*Seu CA ganha +1 nos testes contra Ácido, Raio e Fogo.*"
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "gnomo": {
      bonus: { int: 2 },
      tracos: [
        "*Astúcia Gnômica:* Você tem vantagem em todos os testes de resistência de Inteligência, Sabedoria e Carisma contra magia.",
        "*Artesão:* Você tem proficiência em artesanato que permite restaurar objetos e equipamentos."
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "meio-elfo": {
      bonus: { car: 2 },
      tracos: [
        "*Ancestralidade Feérica:* Você tem vantagem em testes de resistência contra encantamentos, e magia não pode lhe fazer dormir."
      ],
      pontosExtrasNivel1: 2,
      pontosExtrasPorNivel: 0
    },
    "meio-orc": {
      bonus: { for: 2 },
      tracos: [
        "*Ameaçador:* Você ganha proficiência na perícia Intimidação.",
        "*Ataques Selvagens:* Ao obter um acerto crítico com um ataque de arma corpo a corpo, você pode rolar um dos dados de dano da arma mais uma vez e adicioná-lo ao dano extra do acerto crítico."
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "tiefling": {
      bonus: { car: 2 },
      tracos: [
        "*Resistência Infernal:* Você tem resistência a dano de fogo.",
        "*Enganador da mana:* Suas magias são afetadas pela sua carisma."
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 0
    },
    "outro": {
      bonus: {},
      tracos: [
        "(Parte editável)",
        "(Parte editável)"
      ],
      pontosExtrasNivel1: 0,
      pontosExtrasPorNivel: 2
    }
  };

  // Gera perícias na interface
  const periciasDiv = document.getElementById('pericias-list');
  pericias.forEach(p => {
    const row = document.createElement('div');
    row.classList.add('pericia-row');
    row.innerHTML = `
      <span class="pericia-nome">${p.nome}</span>
      <span class="pericia-bonus"><input type="text" disabled id="bonus-${
