<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Ficha de RPG Completa</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    margin: 20px; 
    background-color: #e8d9f0; /* Roxo claro */
  }
  label { display: block; margin-top: 10px; }
  input, textarea, select { 
    width: 100%; 
    margin-bottom: 10px; 
    padding: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  textarea {
    resize: vertical;
  }
  .readonly { background-color: #eee; }
  #lore, #inventario, #magias {
    height: 150px; /* Campos maiores */
    font-size: 14px;
  }
  .oculto {
    display: none;
  }
</style>
</head>
<body>

<!-- Login -->
<div id="loginContainer">
<h1>Login - Ficha RPG</h1>
<label>Nome de usuário:</label>
<input type="text" id="loginUsuario">
<label>Senha:</label>
<input type="password" id="loginSenha">
<button onclick="login()">Entrar</button>

<!-- Cadastro -->
<h2>Cadastro</h2>
<label>Nome de usuário:</label>
<input type="text" id="cadastroUsuario">
<label>Senha:</label>
<input type="password" id="cadastroSenha">
<button onclick="cadastrar()">Cadastrar</button>
</div>

<hr>

<!-- Ficha -->
<div id="fichaContainer" class="oculto">
<h1>Ficha de RPG Completa</h1>
<button onclick="logout()">Logout</button>

<label>Nível:</label>
<input type="number" id="nivel" min="1" value="1">

<label>Nome:</label>
<input type="text" id="nome">

<label>Classe:</label>
<input type="text" id="classe">

<label>Raça:</label>
<input type="text" id="raca">

<label>Antecedente:</label>
<input type="text" id="antecedente">

<h3>Atributos</h3>
<p>Pontos restantes: <span id="pontosRestantes">28</span></p>
<div id="atributosContainer"></div>

<!-- Iniciativa -->
<label for="iniciativa">Iniciativa:</label>
<input type="text" id="iniciativa" readonly />

<!-- Campo de CA -->
<label for="ca">Classe de Armadura (CA):</label>
<input type="text" id="ca" readonly style="font-weight:bold; font-size:1.2em; width:100px; margin-bottom: 10px;" />

<label>Lore / Características Gerais:</label>
<textarea id="lore"></textarea>

<label>Inventário:</label>
<textarea id="inventario"></textarea>

<label>Magias:</label>
<textarea id="magias"></textarea>

<button onclick="salvarFicha()">Salvar Ficha</button>
<button onclick="exportarFicha()">Exportar Ficha (TXT)</button>
</div>

<script>
let atributos = {
  "Força": 8,
  "Destreza": 8,
  "Constituição": 8,
  "Inteligência": 8,
  "Sabedoria": 8,
  "Carisma": 8
};

let pontosRestantes = 28;
let usuarioAtual = null;

function criarCamposAtributos() {
  let container = document.getElementById("atributosContainer");
  container.innerHTML = "";
  for (let atributo in atributos) {
    let label = document.createElement("label");
    label.textContent = atributo;
    let input = document.createElement("input");
    input.type = "number";
    input.min = 8;
    input.max = 15;
    input.value = atributos[atributo];
    input.id = "attr_" + atributo;
    input.addEventListener("input", function() {
      let valor = parseInt(this.value) || 8;
      let diferenca = valor - atributos[atributo];
      if (pontosRestantes - diferenca >= 0) {
        atributos[atributo] = valor;
        pontosRestantes -= diferenca;
      } else {
        this.value = atributos[atributo];
      }
      document.getElementById("pontosRestantes").textContent = pontosRestantes;
      atualizarTudo();
    });
    container.appendChild(label);
    container.appendChild(input);
  }
}

function calculaBonus(valor) {
  return Math.floor((valor - 10) / 2);
}

function atualizarIniciativa() {
  let bonusDex = calculaBonus(atributos["Destreza"]);
  document.getElementById("iniciativa").value =
    bonusDex >= 0 ? `+${bonusDex}` : bonusDex;
}

function atualizarCA() {
  let bonusDex = calculaBonus(atributos["Destreza"]);
  let bonusCon = calculaBonus(atributos["Constituição"]);
  let bonusSab = calculaBonus(atributos["Sabedoria"]);
  let totalCA = bonusDex + bonusCon + bonusSab;
  document.getElementById("ca").value =
    totalCA >= 0 ? `+${totalCA}` : totalCA;
}

function atualizarTudo() {
  atualizarIniciativa();
  atualizarCA();
}

function salvarFicha() {
  if (!usuarioAtual) return;
  let ficha = {
    nivel: document.getElementById("nivel").value,
    nome: document.getElementById("nome").value,
    classe: document.getElementById("classe").value,
    raca: document.getElementById("raca").value,
    antecedente: document.getElementById("antecedente").value,
    atributos,
    iniciativa: document.getElementById("iniciativa").value,
    ca: document.getElementById("ca").value,
    lore: document.getElementById("lore").value,
    inventario: document.getElementById("inventario").value,
    magias: document.getElementById("magias").value
  };
  localStorage.setItem("ficha_" + usuarioAtual, JSON.stringify(ficha));
  alert("Ficha salva para " + usuarioAtual + "!");
}

function carregarFicha() {
  let dados = localStorage.getItem("ficha_" + usuarioAtual);
  if (dados) {
    let ficha = JSON.parse(dados);
    document.getElementById("nivel").value = ficha.nivel;
    document.getElementById("nome").value = ficha.nome;
    document.getElementById("classe").value = ficha.classe;
    document.getElementById("raca").value = ficha.raca;
    document.getElementById("antecedente").value = ficha.antecedente;
    atributos = ficha.atributos;
    pontosRestantes = 28 - (Object.values(atributos).reduce((a,b)=>a+b,0) - (8*6));
    document.getElementById("pontosRestantes").textContent = pontosRestantes;
    criarCamposAtributos();
    document.getElementById("iniciativa").value = ficha.iniciativa;
    document.getElementById("ca").value = ficha.ca;
    document.getElementById("lore").value = ficha.lore;
    document.getElementById("inventario").value = ficha.inventario;
    document.getElementById("magias").value = ficha.magias;
    atualizarTudo();
  }
}

function exportarFicha() {
  let conteudo = `
Nível: ${document.getElementById("nivel").value}
Nome: ${document.getElementById("nome").value}
Classe: ${document.getElementById("classe").value}
Raça: ${document.getElementById("raca").value}
Antecedente: ${document.getElementById("antecedente").value}
Atributos: ${JSON.stringify(atributos)}
Iniciativa: ${document.getElementById("iniciativa").value}
Classe de Armadura: ${document.getElementById("ca").value}
Lore: ${document.getElementById("lore").value}
Inventário: ${document.getElementById("inventario").value}
Magias: ${document.getElementById("magias").value}
`;
  let blob = new Blob([conteudo], { type: "text/plain" });
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "ficha.txt";
  a.click();
}

function cadastrar() {
  let usuario = document.getElementById("cadastroUsuario").value;
  let senha = document.getElementById("cadastroSenha").value;
  if (!usuario || !senha) {
    alert("Preencha todos os campos!");
    return;
  }
  if (localStorage.getItem("user_" + usuario)) {
    alert("Usuário já existe!");
    return;
  }
  localStorage.setItem("user_" + usuario, senha);
  alert("Usuário cadastrado!");
}

function login() {
  let usuario = document.getElementById("loginUsuario").value;
  let senha = document.getElementById("loginSenha").value;
  let senhaSalva = localStorage.getItem("user_" + usuario);
  if (senhaSalva && senhaSalva === senha) {
    usuarioAtual = usuario;
    document.getElementById("loginContainer").classList.add("oculto");
    document.getElementById("fichaContainer").classList.remove("oculto");
    carregarFicha();
    criarCamposAtributos();
    atualizarTudo();
  } else {
    alert("Usuário ou senha incorretos!");
  }
}

function logout() {
  usuarioAtual = null;
  document.getElementById("loginContainer").classList.remove("oculto");
  document.getElementById("fichaContainer").classList.add("oculto");
}

criarCamposAtributos();
atualizarTudo();
</script>

</body>
</html>
